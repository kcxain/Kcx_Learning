<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-system/CSAPP/Lab09-Proxy_Lab">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Lab9-Proxy Lab æ·±å…¥è§£æ | Kcxain&#x27;s Blog</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://deconx.cn/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://deconx.cn/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://deconx.cn/docs/system/CSAPP/Lab09-Proxy_Lab"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Lab9-Proxy Lab æ·±å…¥è§£æ | Kcxain&#x27;s Blog"><meta data-rh="true" name="description" content="å®éªŒæ¦‚è§ˆ"><meta data-rh="true" property="og:description" content="å®éªŒæ¦‚è§ˆ"><link data-rh="true" rel="icon" href="/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://deconx.cn/docs/system/CSAPP/Lab09-Proxy_Lab"><link data-rh="true" rel="alternate" href="https://deconx.cn/docs/system/CSAPP/Lab09-Proxy_Lab" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://deconx.cn/docs/system/CSAPP/Lab09-Proxy_Lab" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://WBXP35154X-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Kcxain&#39;s Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Kcxain&#39;s Blog Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Kcxain&#39;s Blog" href="/opensearch.xml">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.134e3c30.css">
<link rel="preload" href="/assets/js/runtime~main.b68ed8aa.js" as="script">
<link rel="preload" href="/assets/js/main.79f420bf.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="è·³åˆ°ä¸»è¦å†…å®¹"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">è·³åˆ°ä¸»è¦å†…å®¹</a></div><nav aria-label="ä¸»å¯¼èˆª" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="åˆ‡æ¢å¯¼èˆªæ " aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">æ½œé¾™å‹¿ç”¨</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">ç¬”è®°ğŸ“–</a><a class="navbar__item navbar__link" href="/blog">æ–‡ç« ğŸ“™</a><a class="navbar__item navbar__link" href="/schedule">æ¯æ—¥è®¡åˆ’ğŸ¤—</a><a class="navbar__item navbar__link" href="/about-me">About MeğŸ˜</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/kcxain" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="åˆ‡æ¢æµ…è‰²/æš—é»‘æ¨¡å¼ï¼ˆå½“å‰ä¸ºæµ…è‰²æ¨¡å¼ï¼‰" aria-label="åˆ‡æ¢æµ…è‰²/æš—é»‘æ¨¡å¼ï¼ˆå½“å‰ä¸ºæµ…è‰²æ¨¡å¼ï¼‰" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="æœç´¢"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">æœç´¢</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="å›åˆ°é¡¶éƒ¨" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="æ–‡æ¡£ä¾§è¾¹æ " class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs">Welcome</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/system">è®¡ç®—æœºåŸºç¡€</a><button aria-label="æ‰“å¼€/æ”¶èµ·ä¾§è¾¹æ èœå•ã€Œè®¡ç®—æœºåŸºç¡€ã€" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/system/CSAPP">CSAPP å®éªŒè§£æ</a><button aria-label="æ‰“å¼€/æ”¶èµ·ä¾§è¾¹æ èœå•ã€ŒCSAPP å®éªŒè§£æã€" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/system/CSAPP/Lab01-Data_Lab">Lab1-Data Lab æ·±å…¥è§£æ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/system/CSAPP/Lab02-Bomb_Lab">Lab2-Bomb Lab æ·±å…¥è§£æ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/system/CSAPP/Lab03-Attack_Lab">Lab3-Attack Lab æ·±å…¥è§£æ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/system/CSAPP/Lab04-Architecture_Lab">Lab4-Architecture Lab æ·±å…¥è§£æ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/system/CSAPP/Lab05-Cache_Lab">Lab5-Cache Lab æ·±å…¥è§£æ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/system/CSAPP/Lab06-Performance_Lab">Lab6-Performance Lab æ·±å…¥è§£æ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/system/CSAPP/Lab07-Shell_Lab">Lab7-Shell Lab æ·±å…¥è§£æ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/system/CSAPP/Lab08-Malloc_Lab">Lab8-Malloc Lab æ·±å…¥è§£æ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/system/CSAPP/Lab09-Proxy_Lab">Lab9-Proxy Lab æ·±å…¥è§£æ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/system/CSAPP/gdb-cheatsheet">gdb å¸¸ç”¨å‘½ä»¤</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/system/Compilers">ç¼–è¯‘åŸç†</a><button aria-label="æ‰“å¼€/æ”¶èµ·ä¾§è¾¹æ èœå•ã€Œç¼–è¯‘åŸç†ã€" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/system/Computer-Network">è®¡ç®—æœºç½‘ç»œ</a><button aria-label="æ‰“å¼€/æ”¶èµ·ä¾§è¾¹æ èœå•ã€Œè®¡ç®—æœºç½‘ç»œã€" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/system/MIT6S081">MIT-6.s081 å®éªŒè§£æ</a><button aria-label="æ‰“å¼€/æ”¶èµ·ä¾§è¾¹æ èœå•ã€ŒMIT-6.s081 å®éªŒè§£æã€" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/system/Software-Construction">è½¯ä»¶æ„é€ </a><button aria-label="æ‰“å¼€/æ”¶èµ·ä¾§è¾¹æ èœå•ã€Œè½¯ä»¶æ„é€ ã€" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/code-daily">ç®—æ³•åˆ·é¢˜</a><button aria-label="æ‰“å¼€/æ”¶èµ·ä¾§è¾¹æ èœå•ã€Œç®—æ³•åˆ·é¢˜ã€" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/ai">äººå·¥æ™ºèƒ½</a><button aria-label="æ‰“å¼€/æ”¶èµ·ä¾§è¾¹æ èœå•ã€Œäººå·¥æ™ºèƒ½ã€" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/project">åŠ¨æ‰‹é€ è½®å­</a><button aria-label="æ‰“å¼€/æ”¶èµ·ä¾§è¾¹æ èœå•ã€ŒåŠ¨æ‰‹é€ è½®å­ã€" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="æ”¶èµ·ä¾§è¾¹æ " aria-label="æ”¶èµ·ä¾§è¾¹æ " class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="é¡µé¢è·¯å¾„"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="ä¸»é¡µé¢" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/system"><span itemprop="name">è®¡ç®—æœºåŸºç¡€</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/system/CSAPP"><span itemprop="name">CSAPP å®éªŒè§£æ</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Lab9-Proxy Lab æ·±å…¥è§£æ</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">æœ¬é¡µæ€»è§ˆ</button></div><div class="theme-doc-markdown markdown"><h1>Lab9-Proxy Lab æ·±å…¥è§£æ</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="å®éªŒæ¦‚è§ˆ">å®éªŒæ¦‚è§ˆ<a href="#å®éªŒæ¦‚è§ˆ" class="hash-link" aria-label="å®éªŒæ¦‚è§ˆçš„ç›´æ¥é“¾æ¥" title="å®éªŒæ¦‚è§ˆçš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>Web Proxy æ˜¯ Web æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ä¸€ä¸ªä¸­é—´ç¨‹åºã€‚æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨æµè§ˆå™¨è®¿é—®æŸä¸ªç½‘ç«™æ—¶ï¼Œæµè§ˆå™¨ä¸æ˜¯ç›´æ¥è¯·æ±‚æœåŠ¡å™¨æ¥è·å–å†…å®¹çš„ï¼Œè€Œæ˜¯è”ç³» Proxyï¼ŒProxy è½¬å‘è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å›å¤ Proxy åï¼ŒProxy å†å°†å›å¤å‘é€åˆ°æµè§ˆå™¨ã€‚</p><p>å³åŸæ¥çš„å®¢æˆ·ç«¯-æœåŠ¡å™¨æ˜¯è¿™æ ·ï¼š</p><p><img loading="lazy" src="/assets/images/image-20220412232840132-a36844968625d857165fa6db39e83608.png" width="1460" height="304" class="img_ev3q"></p><p>åŠ äº† Proxy å˜æˆè¿™æ ·</p><p><img loading="lazy" src="/assets/images/image-20220412233236559-234e52313bff76b1842dff2790491349.png" width="1523" height="326" class="img_ev3q"></p><p>æœ¬å®éªŒå°±æ˜¯è¦å®ç°ä¸€ä¸ªæ”¯æŒ<strong>å¤šçº¿ç¨‹å¸¦ç¼“å­˜</strong>çš„ Web ä»£ç†ï¼Œåˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†æ¥è¿›è¡Œï¼š</p><ul><li><strong>Part 1</strong>ï¼šå®ç°ä¸€ä¸ªæœ€åŸºç¡€çš„é¡ºåºä»£ç†</li><li><strong>Part 2</strong>ï¼šè¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œä½¿ä»£ç†æ”¯æŒå¤šçº¿ç¨‹ï¼ˆç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼‰</li><li><strong>Part 3</strong>ï¼šä½¿ç”¨ LRU ç­–ç•¥ç¼“å­˜ Web ä¸­çš„å¯¹è±¡ï¼ˆè¯»è€…-å†™è€…æ¨¡å‹ï¼‰</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tiny-web-æœåŠ¡å™¨è¯¦è§£">TINY Web æœåŠ¡å™¨è¯¦è§£<a href="#tiny-web-æœåŠ¡å™¨è¯¦è§£" class="hash-link" aria-label="TINY Web æœåŠ¡å™¨è¯¦è§£çš„ç›´æ¥é“¾æ¥" title="TINY Web æœåŠ¡å™¨è¯¦è§£çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>ä»£ç†ç›¸å¯¹äºå®¢æˆ·ç«¯æ¥è¯´å……å½“äº†æœåŠ¡ç«¯çš„è§’è‰²ï¼Œç›¸å¯¹äºæœåŠ¡ç«¯æ¥è¯´åˆå……å½“äº†å®¢æˆ·ç«¯çš„è§’è‰²ï¼Œæ‰€ä»¥å¯ä»¥å¤§é‡åˆ©ç”¨ä¹¦ä¸­è®²è§£æœåŠ¡å™¨çš„ä»£ç ã€‚</p><p>CSAPP è¯¾æœ¬ç”¨ 250 è¡Œä»£ç ä¸ºæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªéå¸¸ç®€å•çš„ Web æœåŠ¡å™¨ï¼Œåœ¨åšå®éªŒä¹‹å‰ï¼Œæ·±åˆ»ç†è§£å®ƒæ˜¯éå¸¸é‡è¦çš„ã€‚</p><p>é¦–å…ˆè¦åšçš„äº‹å°±æ˜¯è§£æ HTTP è¯·æ±‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="è§£æ-http-è¯·æ±‚">è§£æ HTTP è¯·æ±‚<a href="#è§£æ-http-è¯·æ±‚" class="hash-link" aria-label="è§£æ HTTP è¯·æ±‚çš„ç›´æ¥é“¾æ¥" title="è§£æ HTTP è¯·æ±‚çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>HTTP è¯·æ±‚çš„ç»„æˆæ˜¯è¿™æ ·çš„ï¼šä¸€ä¸ªè¯·æ±‚è¡Œï¼Œåé¢è·Ÿéšé›¶ä¸ªæˆ–æ›´å¤šä¸ªè¯·æ±‚æŠ¥å¤´ï¼Œåœ¨è·Ÿéšä¸€ä¸ªç©ºçš„æ–‡æœ¬è¡Œæ¥ç»ˆæ­¢æŠ¥å¤´åˆ—è¡¨ã€‚è¯·æ±‚è¡Œçš„å½¢å¼æ˜¯ï¼š<code>method URI version</code>ï¼Œæœ¬æœåŠ¡å™¨åªæ”¯æŒ GET æ–¹æ³•</p><p>å°† URI è§£æå‡ºæ¥åï¼Œéœ€è¦åˆ¤æ–­è¯·æ±‚çš„æ˜¯é™æ€å†…å®¹è¿˜æ˜¯åŠ¨æ€å†…å®¹ï¼Œåˆ†åˆ«æ‰§è¡Œã€‚ç»™å‡ºå‡½æ•°<code>doit</code></p><p><img loading="lazy" src="/assets/images/image-20220412194849510-cdfb8acf15639fa780b637f15491a492.png" width="1100" height="677" class="img_ev3q"></p><p><img loading="lazy" src="/assets/images/image-20220413072204676-3142f5bd8b496545fa3835a74c302774.png" width="993" height="842" class="img_ev3q"></p><p>è§£æ URI éƒ½æ˜¯ç»†èŠ‚ä¸Šçš„é—®é¢˜ï¼Œè¿™é‡Œä¸å†åˆ†æ</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="æä¾›é™æ€å†…å®¹">æä¾›é™æ€å†…å®¹<a href="#æä¾›é™æ€å†…å®¹" class="hash-link" aria-label="æä¾›é™æ€å†…å®¹çš„ç›´æ¥é“¾æ¥" title="æä¾›é™æ€å†…å®¹çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>ä¸€ä¸ª HTTP å“åº”çš„ç»„æˆæ˜¯è¿™æ ·çš„ï¼šä¸€ä¸ªå“åº”è¡Œï¼Œåé¢è·Ÿéšç€é›¶ä¸ªæˆ–æ›´å¤šçš„ç›¸åº”æŠ¥å¤´ï¼Œå†è·Ÿéšç€ä¸€ä¸ªç»ˆæ­¢æŠ¥å¤´çš„ç©ºè¡Œï¼Œéšåè·Ÿéšå“åº”ä¸»ä½“ï¼Œç›¸åº”è¡Œçš„æ ¼å¼ä¸º<code>version status-code status-massage</code>ã€‚äºæ˜¯ç»™å‡ºå‡½æ•°<code>serve_static</code></p><p><img loading="lazy" src="/assets/images/image-20220412194347578-208410d0d4d71ab3383abb8d198006b3.png" width="1076" height="851" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="æä¾›åŠ¨æ€å†…å®¹">æä¾›åŠ¨æ€å†…å®¹<a href="#æä¾›åŠ¨æ€å†…å®¹" class="hash-link" aria-label="æä¾›åŠ¨æ€å†…å®¹çš„ç›´æ¥é“¾æ¥" title="æä¾›åŠ¨æ€å†…å®¹çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>TINY æ´¾ç”Ÿä¸€ä¸ªå­è¿›ç¨‹å¹¶åœ¨å­è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œä¸€ä¸ª CGI ç¨‹åº</p><p><img loading="lazy" src="/assets/images/image-20220412195522104-6e203ce7a889735b481893ced4a8b1bd.png" width="1227" height="673" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ä¸»å‡½æ•°">ä¸»å‡½æ•°<a href="#ä¸»å‡½æ•°" class="hash-link" aria-label="ä¸»å‡½æ•°çš„ç›´æ¥é“¾æ¥" title="ä¸»å‡½æ•°çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p><img loading="lazy" src="/assets/images/image-20220412233611252-a9123d2c18685d2a4773277bb4e827e3.png" width="1212" height="880" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="part-1-implementing-a-sequential-web-proxy">Part 1: Implementing A sequential web proxy<a href="#part-1-implementing-a-sequential-web-proxy" class="hash-link" aria-label="Part 1: Implementing A sequential web proxyçš„ç›´æ¥é“¾æ¥" title="Part 1: Implementing A sequential web proxyçš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>è¦æ±‚ï¼š</p><ul><li><p>å®ç°ä¸€ä¸ªå¤„ç† HTTP/1.0 GET è¯·æ±‚çš„åŸºæœ¬é¡ºåº web ä»£ç†</p></li><li><p>å¦‚æœæ¥æ”¶åˆ°ä¸€ä¸ªæµè§ˆå™¨è¯·æ±‚ä¸º HTTP/1.1 ç‰ˆæœ¬ï¼Œåˆ™åº”å°†å®ƒä½œä¸º HTTP/1.0 è¯·æ±‚è½¬å‘</p></li><li><p>è½¬å‘åˆæ³•çš„ HTTP è¯·æ±‚</p><ul><li>å‡è®¾è¯·æ±‚ä¸º <code>GET http://www.cmu.edu/hub/index.html HTTP/1.1</code></li><li>åˆ™ä¸»æœºåä¸º <code>www.cmu.edu</code></li><li>è¯·æ±‚çš„é¡µé¢ä¸º <code>/hub/index.html</code></li><li>HTTP è¯·æ±‚æ¯è¡Œä»¥ <code>\r\n</code> ç»“æŸï¼Œä»¥ä¸€ä¸ªç©ºè¡Œ <code>\r\n</code> ç»“å°¾</li></ul></li><li><p>ä»£ç†å‘é€çš„è¯·æ±‚çš„ header ä¸ºï¼š</p><ul><li><p><code>Host</code>: å¦‚ <code>Host: www.cmu.edu</code></p></li><li><p><code>User-Agent</code>: å¦‚ <code>User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:10.0.3) Gecko/20120305 Firefox/10.0.3</code></p></li><li><p><code>Connection</code>: å¿…é¡»å‘é€ <code>Connection: close</code></p></li><li><p><code>Proxy-Connection</code>: å¿…é¡»å‘é€ <code>Proxy-Connection: close</code></p></li></ul></li><li><p>è¦å¤„ç†è¿‡æ—©å…³é—­çš„è¿æ¥ï¼Œå³å¿…é¡»æ•è· SIGPIPE ä¿¡å·</p></li></ul><p>è¿™éƒ¨åˆ†æ²¡ä»€ä¹ˆå¥½è¯´çš„</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥">ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥<a href="#ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥" class="hash-link" aria-label="ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥çš„ç›´æ¥é“¾æ¥" title="ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>é¦–å…ˆæ˜¯æˆ‘ä»¬çš„<code>main</code>å‡½æ•°ï¼Œä¸æ–­ç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œä»£ç ä¸ TINYæœåŠ¡å™¨ä»£ç å®Œå…¨ç›¸åŒï¼Œä¸å†è®²è§£</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> argc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">argv</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> listenfd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> connfd</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">socklen_t</span><span class="token plain"> clientlen</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> hostname</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MAXLINE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> port</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MAXLINE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">sockaddr_storage</span><span class="token plain"> clientaddr</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">argc </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">fprintf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">stderr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;usage :%s &lt;port&gt; \n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> argv</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">exit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">signal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SIGPIPE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sigpipe_handler</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">//æ•è·SIGPIPEä¿¡å·</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listenfd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Open_listenfd</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">argv</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        clientlen </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">clientaddr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        connfd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Accept</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">listenfd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SA </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">clientaddr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">clientlen</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">Getnameinfo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SA </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">clientaddr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> clientlen</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hostname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> MAXLINE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> port</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> MAXLINE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Accepted connection from (%s %s).\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hostname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> port</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">doit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">connfd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//å…³é—­å®¢æˆ·ç«¯çš„è¿æ¥æè¿°ç¬¦</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">Close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">connfd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="è½¬å‘ä¸å›å¤">è½¬å‘ä¸å›å¤<a href="#è½¬å‘ä¸å›å¤" class="hash-link" aria-label="è½¬å‘ä¸å›å¤çš„ç›´æ¥é“¾æ¥" title="è½¬å‘ä¸å›å¤çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p><code>doit</code>å‡½æ•°å‰åŠéƒ¨åˆ†ä¸ TINY æœåŠ¡å™¨ç›¸ä¼¼ï¼Œä¸åŒçš„æ˜¯å°†ååŠéƒ¨åˆ†çš„è¯·æ±‚å¤„ç†æ”¹ä¸ºè½¬å‘ç»™æœåŠ¡å™¨ï¼Œå†å°†æœåŠ¡å™¨çš„å›å¤å›å¤ç»™å®¢æˆ·ç«¯</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">doit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> connfd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> buf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MAXLINE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> method</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MAXLINE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> uri</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MAXLINE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> version</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MAXLINE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> server</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MAXLINE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">rio_t</span><span class="token plain"> rio</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> server_rio</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Rio_readinitb</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">rio</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> connfd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Rio_readlineb</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">rio</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> buf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> MAXLINE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sscanf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;%s %s %s&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> method</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> uri</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> version</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">strcasecmp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">method</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;GET&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Proxy does not implement the method&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">Uri</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">uri_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">Uri</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token function" style="color:#d73a49">malloc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">Uri</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//è§£æuri</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">parse_uri</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uri</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> uri_data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//è®¾ç½®header</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">build_header</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> uri_data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">rio</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//è¿æ¥æœåŠ¡å™¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> serverfd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Open_clientfd</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uri_data</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">host</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> uri_data</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">port</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">serverfd </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;connection failed\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//è½¬å‘ç»™æœåŠ¡å™¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Rio_readinitb</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">server_rio</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> serverfd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Rio_writen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">serverfd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> server</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strlen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">size_t</span><span class="token plain"> n</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//å›å¤ç»™å®¢æˆ·ç«¯</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Rio_readlineb</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">server_rio</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> buf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> MAXLINE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;proxy received %d bytes,then send\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">Rio_writen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">connfd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> buf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//å…³é—­æœåŠ¡å™¨æè¿°ç¬¦</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">serverfd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="è§£æuri">è§£æuri<a href="#è§£æuri" class="hash-link" aria-label="è§£æuriçš„ç›´æ¥é“¾æ¥" title="è§£æuriçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>æ ¹æ® uri ç»“æ„å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ï¼š</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">Uri</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> host</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MAXLINE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//hostname</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> port</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MAXLINE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//ç«¯å£</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> path</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MAXLINE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//è·¯å¾„</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è§£æå‡½æ•°ï¼š</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//è§£æuri</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">parse_uri</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">uri</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">Uri</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">uri_data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">hostpose </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strstr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uri</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;//&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//é»˜è®¤ç«¯å£ä¸º80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hostpose </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">pathpose </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strstr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uri</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pathpose </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">strcpy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uri_data</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pathpose</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">strcpy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uri_data</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">port</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;80&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">portpose </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strstr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hostpose </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;:&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">portpose </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> tmp</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">sscanf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">portpose </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;%d%s&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">tmp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> uri_data</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">sprintf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uri_data</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">port</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;%d&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tmp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">portpose </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token char">&#x27;\0&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">pathpose </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strstr</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hostpose </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pathpose </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">strcpy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uri_data</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pathpose</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">strcpy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uri_data</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">port</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;80&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">pathpose </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token char">&#x27;\0&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">strcpy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uri_data</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">host</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hostpose </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="æµ‹è¯•ä¸ç»“æœ">æµ‹è¯•ä¸ç»“æœ<a href="#æµ‹è¯•ä¸ç»“æœ" class="hash-link" aria-label="æµ‹è¯•ä¸ç»“æœçš„ç›´æ¥é“¾æ¥" title="æµ‹è¯•ä¸ç»“æœçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œè¿™ä¸ª<code>driver.sh</code>åœ¨ wsl ä¸Šæ€»æ˜¯å‡ºé—®é¢˜ï¼Œåªå¥½æ‹¿å‡ºæˆ‘çš„ vm è™šæ‹Ÿæœºæ¥è·‘äº†</p><p><img loading="lazy" src="/assets/images/image-20220413114835337-4efd96c332822cc1a931b294d7d22bba.png" width="873" height="810" class="img_ev3q"></p><p>40 åˆ†å…¨éƒ¨æ‹¿åˆ°ï¼</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="part-2-dealing-with-multiple-concurrent-requests">Part 2: Dealing with multiple concurrent requests<a href="#part-2-dealing-with-multiple-concurrent-requests" class="hash-link" aria-label="Part 2: Dealing with multiple concurrent requestsçš„ç›´æ¥é“¾æ¥" title="Part 2: Dealing with multiple concurrent requestsçš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>è®¾è®¡å¤šçº¿ç¨‹å¹¶å‘å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Œè¿™é‡Œé‡‡ç”¨é¢„çº¿ç¨‹åŒ–çš„æŠ€æœ¯ï¼Œå¦‚å›¾ï¼š</p><p><img loading="lazy" src="/assets/images/image-20220413115833749-67fbb35bca8fc9702d2c244555ebb204.png" width="1631" height="559" class="img_ev3q"></p><p>è¿™æ˜¯ä¸€ä¸ªç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼Œæˆ‘ä»¬å›é¡¾ä¸€ä¸‹ï¼š</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹">ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹<a href="#ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹" class="hash-link" aria-label="ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹çš„ç›´æ¥é“¾æ¥" title="ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çº¿ç¨‹å…±äº«ä¸€ä¸ªæœ‰ n ä¸ªæ§½çš„ä¼˜å…ˆç¼“å†²åŒºï¼Œç”Ÿäº§è€…åå¤åœ°ç”Ÿæˆæ–°çš„é¡¹ç›®ï¼Œå¹¶æŠŠå®ƒä»¬æ’å…¥åˆ°ç¼“å†²åŒºä¸­ã€‚æ¶ˆè´¹è€…çº¿ç¨‹ä¸æ–­ä»ç¼“å†²åŒºä¸­å–å‡ºï¼Œè¿™äº›é¡¹ç›®ç„¶åä½¿ç”¨å®ƒä»¬ã€‚å› ä¸ºæ’å…¥å’Œå–å‡ºé¡¹ç›®éƒ½æ¶‰åŠæ›´æ–°å…±äº«å˜é‡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»ä¿è¯å¯¹ç¼“å†²åŒºåœ°è®¿é—®æ˜¯äº’æ–¥çš„ï¼Œå¹¶è°ƒåº¦å¯¹ç¼“å†²åŒºåœ°è®¿é—®ï¼š</p><ul><li>å¦‚æœæ²¡æœ‰æ§½ä½ï¼šç”Ÿäº§è€…å¿…é¡»ç­‰å¾…</li><li>å¦‚æœæ²¡æœ‰é¡¹ç›®ï¼šæ¶ˆè´¹è€…å¿…é¡»ç­‰å¾…</li></ul><p>åœ¨é¢„çº¿ç¨‹åŒ–çš„æœåŠ¡å™¨ä¸­ï¼Œå®¢æˆ·ç«¯å°±æ˜¯ç”Ÿäº§è€…ï¼Œä¸æ–­äº§ç”Ÿè¿æ¥ï¼›Proxy å°±æ˜¯æ¶ˆè´¹è€…ï¼Œä¸æ–­é€‰ä¸­å®¢æˆ·ç«¯è¿æ¥</p><p>ä¸ºæ­¤ï¼Œå¼€å‘ä¸€ä¸ª SBUF åŒ…æ¥å®ç°è¿™ä¸ªç¼“å†²åŒºåœ°è°ƒåº¦ã€‚ç¼“å†²åŒºè®¾è®¡ï¼š</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">typedef</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">buf</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">/* Buffer array */</span><span class="token plain">         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> n</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">             </span><span class="token comment" style="color:#999988;font-style:italic">/* Maximum number of slots */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> front</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic">/* buf[(front+1)%n] is first item */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> rear</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">/* buf[rear%n] is last item */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">sem_t</span><span class="token plain"> mutex</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic">/* Protects accesses to buf */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">sem_t</span><span class="token plain"> slots</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic">/* Counts available slots */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">sem_t</span><span class="token plain"> items</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic">/* Counts available items */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token class-name">sbuf_t</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>å…¶ä¸­æœ‰ 3 ä¸ªä¿¡å·é‡<ul><li>mutex åˆå§‹åŒ–ä¸º 1ï¼Œä¿è¯å¯¹ç¼“å†²åŒºçš„è®¿é—®æ˜¯äº’æ–¥çš„</li><li>slots åˆå§‹åŒ–ä¸º nï¼Œè®°å½•æ§½ä½</li><li>items åˆå§‹åŒ–ä¸º 0ï¼Œè®°å½•é¡¹ç›®æ•°</li></ul></li></ul><p>ç”±æ­¤ï¼Œè®¾è®¡å®¢æˆ·ç«¯å‘ç¼“å†²åŒºæ’å…¥å‡½æ•°ï¼š</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sbuf_insert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">sbuf_t</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">sp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> item</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">P</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">sp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">slots</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">                          </span><span class="token comment" style="color:#999988;font-style:italic">/* Wait for available slot */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">P</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">sp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">mutex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">                          </span><span class="token comment" style="color:#999988;font-style:italic">/* Lock the buffer */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">buf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">++</span><span class="token plain">sp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">rear</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> item</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">/* Insert the item */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">V</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">sp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">mutex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">                          </span><span class="token comment" style="color:#999988;font-style:italic">/* Unlock the buffer */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">V</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">sp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">items</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">                          </span><span class="token comment" style="color:#999988;font-style:italic">/* Announce available item */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>é¦–å…ˆæœ‰ä¸€ä¸ªå¯¹ slots çš„ P æ“ä½œï¼Œä¿è¯äº†å¦‚æœæ§½ä½å·²æ»¡ï¼Œåˆ™å®¢æˆ·ç«¯è¢«æŒ‚èµ·ï¼Œä¸ä¼šç»§ç»­å¾€ç¼“å†²åŒºå†™å…¥è¯·æ±‚</li><li>ç„¶åæ˜¯ä¸€ä¸ª mutex çš„ P æ“ä½œï¼Œä¿è¯äº†å¯¹ç¼“å†²åŒºäº’æ–¥çš„è®¿é—®</li><li>ç¼“å†²åŒºæ’å…¥å®Œæˆåï¼Œé‡Šæ”¾æ‰€æœ‰çš„é”</li></ul><p>è®¾è®¡ Proxy ä»ç¼“å†²åŒºè¯»å…¥çš„å‡½æ•°ï¼š</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sbuf_remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">sbuf_t</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">sp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> item</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">P</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">sp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">items</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">                          </span><span class="token comment" style="color:#999988;font-style:italic">/* Wait for available item */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">P</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">sp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">mutex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">                          </span><span class="token comment" style="color:#999988;font-style:italic">/* Lock the buffer */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    item </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">buf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">++</span><span class="token plain">sp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">front</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">%</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/* Remove the item */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">V</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">sp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">mutex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">                          </span><span class="token comment" style="color:#999988;font-style:italic">/* Unlock the buffer */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">V</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">sp</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">slots</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">                          </span><span class="token comment" style="color:#999988;font-style:italic">/* Announce available slot */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> item</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>é¦–å…ˆæœ‰ä¸€ä¸ªå¯¹ items çš„ P æ“ä½œï¼Œä¿è¯äº†å¦‚æœæ²¡æœ‰é¡¹ç›®ï¼Œåˆ™ Proxy è¢«æŒ‚èµ·ï¼Œä¸ä¼šç»§ç»­å¾€ç¼“å†²åŒºè¯»å‡ºå®¢æˆ·ç«¯</li><li>ç„¶åæ˜¯ä¸€ä¸ª mutex çš„ P æ“ä½œï¼Œä¿è¯äº†å¯¹ç¼“å†²åŒºäº’æ–¥çš„è®¿é—®</li><li>ç¼“å†²åŒºè¯»å‡ºå®Œæˆåï¼Œé‡Šæ”¾æ‰€æœ‰çš„é”ï¼Œè¿”å›å…¶ä¸­ä¸€ä¸ªå®¢æˆ·ç«¯çš„æè¿°ç¬¦</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="åŸºäºé¢„çº¿ç¨‹åŒ–çš„-proxy">åŸºäºé¢„çº¿ç¨‹åŒ–çš„ Proxy<a href="#åŸºäºé¢„çº¿ç¨‹åŒ–çš„-proxy" class="hash-link" aria-label="åŸºäºé¢„çº¿ç¨‹åŒ–çš„ Proxyçš„ç›´æ¥é“¾æ¥" title="åŸºäºé¢„çº¿ç¨‹åŒ–çš„ Proxyçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>å¤§éƒ¨åˆ†ä»£ç ä¸ç¬¬ 1 éƒ¨åˆ†ä¸€æ ·</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> argc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">argv</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> listenfd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> connfd</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">socklen_t</span><span class="token plain"> clientlen</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> hostname</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MAXLINE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> port</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MAXLINE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">sockaddr_storage</span><span class="token plain"> clientaddr</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">pthread_t</span><span class="token plain"> tid</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">argc </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">fprintf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">stderr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;usage :%s &lt;port&gt; \n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> argv</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">exit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">signal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SIGPIPE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sigpipe_handler</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listenfd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Open_listenfd</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">argv</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sbuf_init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">sbuf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SBUFSIZE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//åˆ›å»ºå·¥ä½œè€…çº¿ç¨‹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> NTHREADS</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">Pthread_create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">tid</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> thread</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        clientlen </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">clientaddr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        connfd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Accept</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">listenfd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SA </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">clientaddr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">clientlen</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//å‘ç¼“å†²åŒºå†™å…¥è¿™ä¸ªæè¿°ç¬¦</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">sbuf_insert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">sbuf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> connfd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">Getnameinfo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SA </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">clientaddr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> clientlen</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hostname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> MAXLINE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> port</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> MAXLINE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Accepted connection from (%s %s).\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> hostname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> port</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç„¶åæ˜¯çº¿ç¨‹æ‰§è¡Œå‡½æ•°ï¼š</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token function" style="color:#d73a49">thread</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">vargp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Pthread_detach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">pthread_self</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//ä»ç¼“å†²åŒºä¸­è¯»å‡ºæè¿°ç¬¦</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> connfd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sbuf_remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">sbuf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//è½¬å‘</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">doit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">connfd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//å…³é—­å®¢æˆ·ç«¯çš„è¿æ¥æè¿°ç¬¦</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">connfd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="æµ‹è¯•ä¸ç»“æœ-1">æµ‹è¯•ä¸ç»“æœ<a href="#æµ‹è¯•ä¸ç»“æœ-1" class="hash-link" aria-label="æµ‹è¯•ä¸ç»“æœçš„ç›´æ¥é“¾æ¥" title="æµ‹è¯•ä¸ç»“æœçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p><strong>è¿™é‡Œæœ‰ä¸€ä¸ªå¤§å‘ï¼</strong></p><p>æµ‹è¯•ç¬¬ 2 éƒ¨åˆ†ï¼Œæ€»æ˜¯æœ‰å¦‚ä¸‹æç¤ºï¼š</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Timeout waiting </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> the server to grab the port reserved </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> it</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æˆ‘ä¸€ç›´ä»¥ä¸ºæ˜¯æˆ‘çš„ç¨‹åºæœ‰ bugï¼Œç»†å¿ƒé˜…è¯»äº†å¥½å¤šéã€‚åæ¥æŸ¥çœ‹ä»–äººåšå®¢ï¼Œå‘ç°æ˜¯<code>driver.sh</code>æ–‡ä»¶å†™çš„æœ‰é—®é¢˜ï¼š</p><p><img loading="lazy" src="/assets/images/image-20220413134605317-7e6d8bc85761c81e2bd35a045327fd9c.png" width="979" height="151" class="img_ev3q"></p><p>è¿™ä¸€éƒ¨åˆ†ï¼Œä½œè€…å†™äº†ä¸€ä¸ª<code>nop-server.py</code>è„šæœ¬æ¨¡æ‹Ÿä¸€ä¸ªæ°¸è¿œä¸ä¼šå“åº”çš„æœåŠ¡å™¨ï¼Œæ¥æµ‹è¯•æˆ‘ä»¬ Proxy çš„å¹¶å‘æ€§èƒ½ã€‚301 è¡Œè¿™é‡Œåº”è¯¥æ”¹ä¸ºï¼š</p><p><img loading="lazy" src="/assets/images/image-20220413135058638-ccb0ab7083db4fada6ed56336fa87273.png" width="992" height="156" class="img_ev3q"></p><p>æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š</p><p><img loading="lazy" src="/assets/images/image-20220413135405874-39dac86b7b43d098deabbd3f502a1ea5.png" width="796" height="293" class="img_ev3q"></p><p>15 åˆ†æ»¡åˆ†ï¼</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="part-3-caching-web-objects">Part 3: Caching web objects<a href="#part-3-caching-web-objects" class="hash-link" aria-label="Part 3: Caching web objectsçš„ç›´æ¥é“¾æ¥" title="Part 3: Caching web objectsçš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>æœç„¶æ˜¯ä¸‡ç‰©çš†å¯åŠ ä¸€å±‚ Cacheã€‚åœ¨ Proxy ä¸­ï¼Œå½“å¤šä¸ªå®¢æˆ·ç«¯æˆ–ä¸€ä¸ªå®¢æˆ·ç«¯å¤šæ¬¡è®¿é—®åŒä¸€ä¸ªæœåŠ¡ç«¯çš„åŒä¸€å¯¹è±¡æ—¶ï¼ŒProxy æ¯æ¬¡éƒ½è¦ä»æœåŠ¡ç«¯è¯·æ±‚ï¼Œè¿™æ˜¯å¾ˆè€—è´¹æ—¶é—´çš„ã€‚å¦‚æœ Proxy èƒ½æŠŠè®¿é—®è¿‡çš„å¯¹è±¡å­˜å‚¨ä¸‹æ¥ï¼Œé‚£ä¹ˆå†æ¬¡é‡åˆ°åŒæ ·çš„è¯·æ±‚æ—¶ï¼Œå°±ä¸éœ€è¦å†è¿æ¥åˆ°æœåŠ¡ç«¯äº†ï¼Œå¯ä»¥ç›´æ¥å›å¤ç»™å®¢æˆ·ç«¯ã€‚è€Œ Cache çš„å¤§å°å¹¶ä¸æ˜¯æ— é™çš„ï¼Œæ‰€ä»¥å°±åˆè¦è€ƒè™‘æ›¿æ¢ç­–ç•¥ï¼Œæœ¬å®éªŒè¦æ±‚ä½¿ç”¨ LRUã€‚</p><p>LRU å’Œ Cache åœ¨ Cache Lab ä¸­æœ‰è¯¦ç»†çš„è®²è¿°ã€‚å› æ­¤ Cache çš„å®ç°åœ¨è¿™é‡Œå°±ä¸å†è®²è§£äº†ï¼Œå¯å‰å¾€æŸ¥çœ‹ï¼š</p><p><a href="https://zhuanlan.zhihu.com/p/484657229" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/484657229</a></p><p>è¿™é‡Œä¸»è¦è®²è§£ä¸€ä¸‹è¯»è€…-å†™è€…æ¨¡å‹</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="è¯»è€…-å†™è€…æ¨¡å‹">è¯»è€…-å†™è€…æ¨¡å‹<a href="#è¯»è€…-å†™è€…æ¨¡å‹" class="hash-link" aria-label="è¯»è€…-å†™è€…æ¨¡å‹çš„ç›´æ¥é“¾æ¥" title="è¯»è€…-å†™è€…æ¨¡å‹çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>ä¸€ç»„å¹¶å‘çš„çº¿ç¨‹è¦è®¿é—®åŒä¸€ä¸ªå…±äº«å¯¹è±¡æ—¶ï¼Œå°†åªè¯»å¯¹è±¡çš„çº¿ç¨‹å«åšè¯»è€…ï¼Œåªä¿®æ”¹å¯¹è±¡çš„è¿›ç¨‹å«åšå†™è€…ã€‚å†™è€…å¿…é¡»æ‹¥æœ‰å¯¹å¯¹è±¡çš„ç‹¬å çš„è®¿é—®ï¼Œè€Œè¯»è€…å¯ä»¥ä¸å…¶å®ƒè¯»è€…å…±äº«å¯¹è±¡ã€‚è¯¥æ¨¡å‹åˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li>è¯»ä¼˜å…ˆï¼šè¦æ±‚ä¸è®©è¯»è€…ç­‰å¾…</li><li>å†™ä¼˜å…ˆï¼šè¦æ±‚åœ¨å†™è€…ä¹‹ååˆ°è¾¾çš„è¯»è€…å¿…é¡»ç­‰å¾…</li></ul><p>å¯¹äºè¯»è€…ä¼˜å…ˆï¼Œåªè¦æœ‰å…¶å®ƒè¯»è€…ï¼Œåˆ™å°±åº”è®©è¯»è€…å…ˆè¯»ï¼Œå› æ­¤è®¾ç½®ä¸€ä¸ª read_cnt è®°å½•è¯»è€…æ•°é‡ï¼Œè¿™ä¸ªå˜é‡å¯¹äºè¯»è€…æ¥è¯´ä¹Ÿæ˜¯äº’æ–¥çš„ï¼Œæ‰€ä»¥è®¾ç½®ä¸€ä¸ª mutex ä¿¡å·é‡æ¥ä¿æŠ¤ï¼Œè¯»çš„è¿‡ç¨‹ä¸­ä¸å…è®¸å†™è€…å†™ï¼Œå†™çš„è¿‡ç¨‹ä¸å…è®¸è¯»è€…è¯»ï¼Œæ‰€ä»¥è®¾ç½® w æ¥ä¿æŠ¤å…±äº«å¯¹è±¡</p><p>è¯»ä¼˜å…ˆä»£ç ï¼š</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> read_cnt</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">sem_t</span><span class="token plain"> mutex</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> w</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//éƒ½åˆå§‹åŒ–ä¸º1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">reader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">P</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">mutex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        readcnt</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">readcnt</span><span class="token operator" style="color:#393A34">==</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">P</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">w</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">V</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">mutex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">P</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">mutex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        readcnt</span><span class="token operator" style="color:#393A34">--</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">readcnt</span><span class="token operator" style="color:#393A34">==</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">V</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">w</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">V</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">mutex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">writer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">P</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">w</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">V</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">w</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>åªæœ‰ç¬¬ä¸€ä¸ªè¯»è€…å¯¹ w åŠ é”ï¼Œæœ€åä¸€ä¸ªè¯»è€…è§£é”ã€‚å› æ­¤ä¸€æ—¦æœ‰ä¸€ä¸ªè¯»è€…åŠ é”ï¼Œå†™è€…å°±æ— æ³•è®¿é—®è¿™ä¸ªå…±äº«å¯¹è±¡äº†ï¼Œè€Œå…¶å®ƒè¯»è€…å¯ä»¥éšæ„è®¿é—®</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cache-ç»“æ„">Cache ç»“æ„<a href="#cache-ç»“æ„" class="hash-link" aria-label="Cache ç»“æ„çš„ç›´æ¥é“¾æ¥" title="Cache ç»“æ„çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>åœ¨æœ¬å®éªŒä¸­ï¼Œå¯¹ Cache çš„è®¿é—®å°±æ˜¯ä¸€ä¸ªç»å…¸çš„è¯»è€…-å†™è€…é—®é¢˜ã€‚æœ‰çš„çº¿ç¨‹è¦ä» Cache ä¸­è¯»å‡ºï¼Œæœ‰çš„çº¿ç¨‹è¦å†™å…¥ Cacheã€‚æ˜¾ç„¶ï¼Œä¸ºäº† Proxy æ›´åŠ é«˜æ•ˆï¼Œè¿™é‡Œåº”è¯¥ç”¨è¯»ä¼˜å…ˆçš„æ¨¡å‹ã€‚ </p><p>å®šä¹‰å¦‚ä¸‹çš„ Cache ç»“æ„</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Cacheç»“æ„</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">typedef</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> obj</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MAX_OBJECT_SIZE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> uri</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MAXLINE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> LRU</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> isEmpty</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> read_cnt</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//è¯»è€…æ•°é‡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">sem_t</span><span class="token plain"> w</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">//Cacheä¿¡å·é‡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">sem_t</span><span class="token plain"> mutex</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//read_cntä¿¡å·é‡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> block</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">typedef</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    block data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MAX_CACHE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> num</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> Cache</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ä»£ç ">ä»£ç <a href="#ä»£ç " class="hash-link" aria-label="ä»£ç çš„ç›´æ¥é“¾æ¥" title="ä»£ç çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>åœ¨<code>doit</code>å‡½æ•°ä¸­ï¼Œå¾—åˆ°ä¸€ä¸ªè¯·æ±‚åï¼Œå…ˆæ ¹æ® uri åˆ¤æ–­ Cache ä¸­æ˜¯å¦å­˜åœ¨è¿™ä¸ªå†…å®¹ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™ç›´æ¥å›å¤ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è¿æ¥æœåŠ¡å™¨ï¼Œå›å¤ç»“æŸåï¼ŒæŠŠå†…å®¹å†™è¿› Cache</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">doit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> connfd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> buf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MAXLINE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> method</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MAXLINE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> uri</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MAXLINE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> version</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MAXLINE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> server</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MAXLINE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">rio_t</span><span class="token plain"> rio</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> server_rio</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> cache_tag</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MAXLINE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Rio_readinitb</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">rio</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> connfd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Rio_readlineb</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">rio</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> buf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> MAXLINE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sscanf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;%s %s %s&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> method</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> uri</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> version</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">strcpy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cache_tag</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> uri</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">strcasecmp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">method</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;GET&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Proxy does not implement the method&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">Uri</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">uri_data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">Uri</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token function" style="color:#d73a49">malloc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">Uri</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//åˆ¤æ–­uriæ˜¯å¦ç¼“å­˜ï¼Œè‹¥ç¼“å­˜ï¼Œç›´æ¥å›å¤</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get_Cache</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cache_tag</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//åŠ é”</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">P</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mutex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_cnt</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_cnt </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">P</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">w</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">V</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mutex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">Rio_writen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">connfd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">obj</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strlen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">obj</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">P</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mutex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_cnt</span><span class="token operator" style="color:#393A34">--</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_cnt </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">V</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">w</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">V</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mutex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//è§£æuri</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">parse_uri</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uri</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> uri_data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//è®¾ç½®header</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">build_header</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> uri_data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">rio</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//è¿æ¥æœåŠ¡å™¨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> serverfd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Open_clientfd</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uri_data</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">host</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> uri_data</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">port</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">serverfd </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;connection failed\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Rio_readinitb</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">server_rio</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> serverfd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Rio_writen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">serverfd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> server</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strlen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">server</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> cache_buf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MAX_OBJECT_SIZE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> size_buf </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">size_t</span><span class="token plain"> n</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">n </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">Rio_readlineb</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">server_rio</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> buf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> MAXLINE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//æ³¨æ„åˆ¤æ–­æ˜¯å¦ä¼šè¶…å‡ºç¼“å­˜å¤§å°</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        size_buf </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> n</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size_buf </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> MAX_OBJECT_SIZE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">strcat</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cache_buf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> buf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;proxy received %d bytes,then send\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">Rio_writen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">connfd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> buf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">serverfd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size_buf </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> MAX_OBJECT_SIZE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">write_Cache</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cache_tag</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cache_buf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>è¦æ³¨æ„ï¼Œæ¯æ¬¡è¯»å†™ç¼“å­˜æ—¶ï¼Œéƒ½è¦åŠ ç›¸åº”çš„é”</li></ul><p>Cache ä»¥åŠ LRU å…·ä½“å®ç°çš„ä»£ç ï¼Œè¯·å‰å¾€æˆ‘çš„ Cache Lab è§£ææŸ¥çœ‹ï¼Œè¿™é‡Œå°±ä¸å†è®²è§£äº†ã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="æµ‹è¯•ä¸ç»“æœ-2">æµ‹è¯•ä¸ç»“æœ<a href="#æµ‹è¯•ä¸ç»“æœ-2" class="hash-link" aria-label="æµ‹è¯•ä¸ç»“æœçš„ç›´æ¥é“¾æ¥" title="æµ‹è¯•ä¸ç»“æœçš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p><img loading="lazy" src="/assets/images/image-20220413154457448-b26d6782437758d8eb55fd2acbd57372.png" width="769" height="344" class="img_ev3q"></p><p>æ»¡åˆ†ï¼</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="firefox-å®æˆ˜æµ‹è¯•">FireFox å®æˆ˜æµ‹è¯•<a href="#firefox-å®æˆ˜æµ‹è¯•" class="hash-link" aria-label="FireFox å®æˆ˜æµ‹è¯•çš„ç›´æ¥é“¾æ¥" title="FireFox å®æˆ˜æµ‹è¯•çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>é¦–å…ˆæ‰“å¼€ Proxyï¼Œç›‘å¬ 15213 ç«¯å£</p><p><img loading="lazy" src="/assets/images/image-20220413155537122-d13b2c6a65f6d0583b2d4cb1a0f68a5f.png" width="1055" height="623" class="img_ev3q"></p><p>é…ç½®ç«ç‹çš„ä»£ç†è®¾ç½®ï¼š</p><p><img loading="lazy" src="/assets/images/image-20220413160804023-a1c64bc1cccea59150c3e8ace9d677f2.png" width="991" height="757" class="img_ev3q"></p><p>éšä¾¿æ‰“å¼€ç™¾åº¦è¯•è¯•</p><p><img loading="lazy" src="/assets/images/image-20220413160832627-928431f4cdfae538cf598d5313db4fe4.png" width="1328" height="697" class="img_ev3q"></p><p>ä¸å‡ºæ„å¤–ï¼Œæ²¡æœ‰è¿æ¥æˆåŠŸã€‚æŸ¥çœ‹ä¸€ä¸‹ Proxy æ‰“å°çš„ä¿¡æ¯</p><p><img loading="lazy" src="/assets/images/image-20220413155927747-712c0751ae57c1331b368280f8667725.png" width="1056" height="625" class="img_ev3q"></p><p>æ˜¯å› ä¸ºè¯·æ±‚çš„éƒ½ä¸æ˜¯ GET æ–¹æ³•</p><p>é‚£å°±åªå¥½è®¿é—®ä¸€ä¸‹ TINY æœåŠ¡å™¨è¯•è¯•äº†ï¼Œå…ˆæ‰“å¼€æœåŠ¡å™¨ï¼Œè®¾ç½®ç«¯å£ä¸º 15214</p><p><img loading="lazy" src="/assets/images/image-20220413160406236-91fe504d814c1d64af113bfece8a6eff.png" width="1055" height="667" class="img_ev3q"></p><p>FireFox è®¿é—®ï¼š<code>localhost: 15214</code></p><p><img loading="lazy" src="/assets/images/image-20220413160538712-80950af43cdebd332a4774cd308254e2.png" width="751" height="430" class="img_ev3q"></p><p>è®¿é—®æˆåŠŸäº†ï¼ç”šè‡³æ˜¾ç¤ºå‡ºäº†å“¥æ–¯æ‹‰ï¼</p><p>Proxy æ‰“å°å‡ºä¸€äº›è½¬å‘ä¿¡æ¯ï¼š</p><p><img loading="lazy" src="/assets/images/image-20220413160630313-fdf9603444f1375a7cec7d732bae2c30.png" width="1061" height="670" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æ€»ç»“">æ€»ç»“<a href="#æ€»ç»“" class="hash-link" aria-label="æ€»ç»“çš„ç›´æ¥é“¾æ¥" title="æ€»ç»“çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><ul><li>æˆ‘åšè¿™ä¸ªå®éªŒæ„Ÿå—éå¸¸ç—›è‹¦ã€‚åŸå› åœ¨äº CSAPP çš„åä¸‰ç« è®²å¾—å¤ªç®€ç•¥äº†ï¼Œå¯¹äºæˆ‘è¿™ç§æ²¡æœ‰å­¦è¿‡æ“ä½œç³»ç»Ÿä¸è®¡ç®—æœºç½‘ç»œçš„äººæ¥è¯´ï¼Œå¼„æ‡‚å®ƒä»¬æ˜¯å¾ˆè‰°éš¾çš„ã€‚æ¯”å¦‚ï¼Œä»ä¿¡å·é‡çš„ Pã€V æ“ä½œåˆ°è¯»è€…-å†™è€…æ¨¡å‹å°±èŠ±è´¹äº†æˆ‘åŠå¤©æ¥ç†è§£</li><li>å½“ç„¶ï¼Œå®Œæˆå®éªŒä¹Ÿæ˜¯æˆå°±æ„Ÿæ»¡æ»¡ã€‚å°¤å…¶æ˜¯æœ€åæ‰“å¼€ FireFoxï¼Œè¿æ¥ä¸Š TINY ï¼Œçœ‹åˆ°å“¥æ–¯æ‹‰è·³å‡ºæ¥çš„é‚£ä¸€åˆ»ï¼Œä¸€ç§æ— ä¸ä¼¦æ¯”çš„å–œæ‚¦ç”±å†…è€Œå¤–è¿¸å‘ï¼Œä¸€åˆ‡è¾›è‹¦éƒ½å€¼å¾—äº†ã€‚</li><li>è¿™ä¸ªå®éªŒè¿˜ä¼šç»§ç»­æ›´æ–°çš„ï¼Œå¸Œæœ›æœ‰ä¸€å¤©èƒ½ç”¨å®ƒè®¿é—®æ‰€æœ‰çš„ç½‘é¡µ</li><li>æœ¬å®éªŒè€—æ—¶ 2 å¤©ï¼Œçº¦ 16 å°æ—¶</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="å†™åœ¨æœ€å">å†™åœ¨æœ€å<a href="#å†™åœ¨æœ€å" class="hash-link" aria-label="å†™åœ¨æœ€åçš„ç›´æ¥é“¾æ¥" title="å†™åœ¨æœ€åçš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>è¯¾æœ¬æ—©å·²åœ¨ä¸Šå‘¨å°±è¯»å®Œäº†ï¼Œè€Œè¿™ä¹Ÿæ˜¯ CSAPP çš„æœ€åä¸€ä¸ªå®éªŒ</p><p>è‡³æ­¤ï¼ŒCSAPP çš„å­¦ä¹ ç®—æ˜¯å‘Šä¸€æ®µè½äº†ã€‚å¯ä»¥è¯´ï¼Œ CSAPP æ˜¯æˆ‘è®¡ç®—æœºçš„å¯è’™æ•™æï¼ŒçœŸæ­£ä¸ºæˆ‘æ‰“å¼€äº†è®¡ç®—æœºé¢†åŸŸçš„å¤§é—¨ï¼Œå¾€åï¼Œæˆ‘å°†ä»¥å®ƒä¸ºçº²ï¼Œå¾€æ›´æ·±å¤„å­¦ä¹ </p><p>è¿˜æœ‰æ›´æ·±çš„æ„Ÿæƒ³ä¸æ€»ç»“ç­‰æœ‰æ—¶é—´äº†å†å•å¼€ä¸€ç¯‡æ–‡ç« å†™å§</p><p>æœ€åï¼Œä»¥ä¾¯æ·è€å¸ˆçš„ä¸€æ®µè¯ç»“æŸæˆ‘è¿™ä¸‰ä¸ªæœˆçš„å†’é™©ä¹‹æ—…</p><blockquote><p>ä½œä¸ºä¸€ä¸ªå¥½çš„å­¦ä¹ è€…ï¼ŒèƒŒæ™¯ä¸æ˜¯é‡ç‚¹ï¼Œé‡è¦çš„æ˜¯ï¼Œä½ æ˜¯å¦å…·å¤‡æ­£ç¡®çš„å­¦ä¹ æ€åº¦ï¼Œèµ·æ­¥å›ºç„¶å¯ä»¥ä»è½»æ¾å°å“å¼€å§‹ï¼Œä½†å¦‚æœç¢°ä¸Šå¤§éƒ¨å¤´å·¨è‘—å°±é€€é¿ä¸‰èˆã€é€ƒä¹‹å¤­å¤­ï¼Œé¢å¯¹ä»»ä½•æŠ€æœ¯åªæ±‚å¿«é¤é€Ÿæˆï¼Œå­¦è¯­è¨€å´ä»æ¥ä¸å†™ç¨‹åºï¼Œé‚£å°±ç»å¯¹æ²¡æœ‰æˆä¸ºé«˜æ‰‹ä¹ƒè‡³ä¸“å®¶çš„ä¸€å¤©ã€‚
æœ‰äº›äººå­¦ä¹ ï¼Œè‡ªç»ƒå°±ä¸€èº«é’¢ç­‹é“éª¨ï¼Œå¯ä»¥åœ¨çƒ­å¸¦ä¸›æ—ä¸­æŠ«è†æ–©æ£˜ï¼Œåœ¨è½è½è‰åŸä¸­è¿½å¥”é€åŒ—ã€‚æœ‰äº›äººçš„å­¦ä¹ ï¼Œæ—¢æœªä¹ æƒ¯å¤§éƒ¨å¤´ä¹¦ï¼Œä¹Ÿä¸ºä¹ æƒ¯ä¸¥è°¨æ ¼è°ƒï¼Œæ›´æœªä¹ æƒ¯è‡ªä¿®å‹¤å­¦ï¼Œæ˜¯æ¸©å®¤é‡Œçš„ä¸€æœµèŠ±ï¼Œæ²¡æœ‰è‡ªç«‹è‡ªå¼ºçš„æœ¬é’±ã€‚</p></blockquote></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/kcxain/Kcx_Learning/tree/master/docs/system/CSAPP/Lab09-Proxy_Lab.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>ç¼–è¾‘æ­¤é¡µ</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="æ–‡æ¡£åˆ†é¡µå¯¼èˆª"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/system/CSAPP/Lab08-Malloc_Lab"><div class="pagination-nav__sublabel">ä¸Šä¸€é¡µ</div><div class="pagination-nav__label">Lab8-Malloc Lab æ·±å…¥è§£æ</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/system/CSAPP/gdb-cheatsheet"><div class="pagination-nav__sublabel">ä¸‹ä¸€é¡µ</div><div class="pagination-nav__label">gdb å¸¸ç”¨å‘½ä»¤</div></a></nav></div><div style="padding-top:50px"></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#å®éªŒæ¦‚è§ˆ" class="table-of-contents__link toc-highlight">å®éªŒæ¦‚è§ˆ</a></li><li><a href="#tiny-web-æœåŠ¡å™¨è¯¦è§£" class="table-of-contents__link toc-highlight">TINY Web æœåŠ¡å™¨è¯¦è§£</a><ul><li><a href="#è§£æ-http-è¯·æ±‚" class="table-of-contents__link toc-highlight">è§£æ HTTP è¯·æ±‚</a></li><li><a href="#æä¾›é™æ€å†…å®¹" class="table-of-contents__link toc-highlight">æä¾›é™æ€å†…å®¹</a></li><li><a href="#æä¾›åŠ¨æ€å†…å®¹" class="table-of-contents__link toc-highlight">æä¾›åŠ¨æ€å†…å®¹</a></li><li><a href="#ä¸»å‡½æ•°" class="table-of-contents__link toc-highlight">ä¸»å‡½æ•°</a></li></ul></li><li><a href="#part-1-implementing-a-sequential-web-proxy" class="table-of-contents__link toc-highlight">Part 1: Implementing A sequential web proxy</a><ul><li><a href="#ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥" class="table-of-contents__link toc-highlight">ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥</a></li><li><a href="#è½¬å‘ä¸å›å¤" class="table-of-contents__link toc-highlight">è½¬å‘ä¸å›å¤</a></li><li><a href="#è§£æuri" class="table-of-contents__link toc-highlight">è§£æuri</a></li><li><a href="#æµ‹è¯•ä¸ç»“æœ" class="table-of-contents__link toc-highlight">æµ‹è¯•ä¸ç»“æœ</a></li></ul></li><li><a href="#part-2-dealing-with-multiple-concurrent-requests" class="table-of-contents__link toc-highlight">Part 2: Dealing with multiple concurrent requests</a><ul><li><a href="#ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹" class="table-of-contents__link toc-highlight">ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹</a></li><li><a href="#åŸºäºé¢„çº¿ç¨‹åŒ–çš„-proxy" class="table-of-contents__link toc-highlight">åŸºäºé¢„çº¿ç¨‹åŒ–çš„ Proxy</a></li><li><a href="#æµ‹è¯•ä¸ç»“æœ-1" class="table-of-contents__link toc-highlight">æµ‹è¯•ä¸ç»“æœ</a></li></ul></li><li><a href="#part-3-caching-web-objects" class="table-of-contents__link toc-highlight">Part 3: Caching web objects</a><ul><li><a href="#è¯»è€…-å†™è€…æ¨¡å‹" class="table-of-contents__link toc-highlight">è¯»è€…-å†™è€…æ¨¡å‹</a></li><li><a href="#cache-ç»“æ„" class="table-of-contents__link toc-highlight">Cache ç»“æ„</a></li><li><a href="#ä»£ç " class="table-of-contents__link toc-highlight">ä»£ç </a></li><li><a href="#æµ‹è¯•ä¸ç»“æœ-2" class="table-of-contents__link toc-highlight">æµ‹è¯•ä¸ç»“æœ</a></li></ul></li><li><a href="#firefox-å®æˆ˜æµ‹è¯•" class="table-of-contents__link toc-highlight">FireFox å®æˆ˜æµ‹è¯•</a></li><li><a href="#æ€»ç»“" class="table-of-contents__link toc-highlight">æ€»ç»“</a></li><li><a href="#å†™åœ¨æœ€å" class="table-of-contents__link toc-highlight">å†™åœ¨æœ€å</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 Kcxain. Built with Docusaurus.</div><div id="contact-me" style="display:flex;justify-content:center"><a href="mailto:kcxain@gmail.com" class="linkicon_PO4W"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="envelope" class="svg-inline--fa fa-envelope" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="font-size:36px"><path fill="currentColor" d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4L236.8 313.6c11.4 8.5 27 8.5 38.4 0L492.8 150.4c12.1-9.1 19.2-23.3 19.2-38.4c0-26.5-21.5-48-48-48H48zM0 176V384c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V176L294.4 339.2c-22.8 17.1-54 17.1-76.8 0L0 176z"></path></svg></a><a href="https://www.zhihu.com/people/deconx" class="linkicon_PO4W"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="zhihu" class="svg-inline--fa fa-zhihu" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" style="font-size:36px"><path fill="currentColor" d="M170.54 148.13v217.54l23.43.01 7.71 26.37 42.01-26.37h49.53V148.13H170.54zm97.75 193.93h-27.94l-27.9 17.51-5.08-17.47-11.9-.04V171.75h72.82v170.31zm-118.46-94.39H97.5c1.74-27.1 2.2-51.59 2.2-73.46h51.16s1.97-22.56-8.58-22.31h-88.5c3.49-13.12 7.87-26.66 13.12-40.67 0 0-24.07 0-32.27 21.57-3.39 8.9-13.21 43.14-30.7 78.12 5.89-.64 25.37-1.18 36.84-22.21 2.11-5.89 2.51-6.66 5.14-14.53h28.87c0 10.5-1.2 66.88-1.68 73.44H20.83c-11.74 0-15.56 23.62-15.56 23.62h65.58C66.45 321.1 42.83 363.12 0 396.34c20.49 5.85 40.91-.93 51-9.9 0 0 22.98-20.9 35.59-69.25l53.96 64.94s7.91-26.89-1.24-39.99c-7.58-8.92-28.06-33.06-36.79-41.81L87.9 311.95c4.36-13.98 6.99-27.55 7.87-40.67h61.65s-.09-23.62-7.59-23.62v.01zm412.02-1.6c20.83-25.64 44.98-58.57 44.98-58.57s-18.65-14.8-27.38-4.06c-6 8.15-36.83 48.2-36.83 48.2l19.23 14.43zm-150.09-59.09c-9.01-8.25-25.91 2.13-25.91 2.13s39.52 55.04 41.12 57.45l19.46-13.73s-25.67-37.61-34.66-45.86h-.01zM640 258.35c-19.78 0-130.91.93-131.06.93v-101c4.81 0 12.42-.4 22.85-1.2 40.88-2.41 70.13-4 87.77-4.81 0 0 12.22-27.19-.59-33.44-3.07-1.18-23.17 4.58-23.17 4.58s-165.22 16.49-232.36 18.05c1.6 8.82 7.62 17.08 15.78 19.55 13.31 3.48 22.69 1.7 49.15.89 24.83-1.6 43.68-2.43 56.51-2.43v99.81H351.41s2.82 22.31 25.51 22.85h107.94v70.92c0 13.97-11.19 21.99-24.48 21.12-14.08.11-26.08-1.15-41.69-1.81 1.99 3.97 6.33 14.39 19.31 21.84 9.88 4.81 16.17 6.57 26.02 6.57 29.56 0 45.67-17.28 44.89-45.31v-73.32h122.36c9.68 0 8.7-23.78 8.7-23.78l.03-.01z"></path></svg></a><a href="https://twitter.com/kecxain" class="linkicon_PO4W"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" class="svg-inline--fa fa-twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="font-size:36px"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a><a href="https://github.com/kcxain" class="linkicon_PO4W"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github-alt" class="svg-inline--fa fa-github-alt" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512" style="font-size:36px"><path fill="currentColor" d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"></path></svg></a></div></div></div></footer></div>
<script src="/assets/js/runtime~main.b68ed8aa.js"></script>
<script src="/assets/js/main.79f420bf.js"></script>
</body>
</html>